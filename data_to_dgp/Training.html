{{ block styles }}
<style>
    .otree-body {
        font: 14px helvetica neue, helvetica, arial, sans-serif;
        max-width: 600px
    }

    #cy {
        margin-left: auto;
        margin-right: auto;
        width: 400px;
        height: 200px;
        display: block;
    }

    #info {
        color: #c88;
        font-size: 2em;
        width: 800px;
        height: 200px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }


</style>

<head>
</head>


{{ endblock }}


{{ block title }}
<dl class="lng-Title" style="text-align:center">Pick the arrows (edges) between variables according to data.</dl>
{{ endblock }}

{{ block content }}

<div class="lang-container" style="text-align:right">
    <table>
        <col width="81%">
        <col width="19%">
        <tr>
            <td></td>
            <td style="border-radius: 8px; border: 1px solid #000; display: block; height: 34px">
                <link rel="stylesheet"
                      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"/>
                <span class="material-symbols-outlined" style="position: relative; top: 3px;">language</span>
                <select class="change-lang" style="border: 1px solid white; position: relative; bottom: 3px;">
                    <option value="en">Eng</option>
                    <option value="ru">Rus</option>
                </select>
            </td>
        </tr>
    </table>
</div>

<!-- {{ formfield "training"  }} -->

<br>
<br>

<dl class="lng-tab1">Before we move on to the task itself, let's look at the demonstration material.</dl>
<dl class="lng-tab2">Here we have two tables with observations. For simplicity, only the observations for X and Y are written out in them. The table on the right is the table for the twin planet (all grains of variable X are mature).</dl>
<dl class="lng-tab3">In this demo, to make it easier for you to familiarize yourself with the problem, two simplifications are made. All mature grains are highlighted in color. All beds are not over rocky soils.</dl>
<dl class="lng-tab4">Please fill in the answer form according to your assumptions about what relationships between strong and weak plants follow from these tables.</dl>

<!--
<br>
<div>
    <p class="lng-TrText">
        Lets figure out how to fill the form!
        Choose (click) the arrows as follows: leave the edge dashed if there is no influence from one variable to
        another variable and make it solid if there is.
        As an example please fill the form for following situation: column Y are dependent from X. Then tap Next.
    </p>

    <br/>
</div>-->

<br>
<table style="width:100%;">
    <tr>
        <td  style="border:15px solid white;">




            <table id="observ" class="table table-striped" style="line-height: 0.8;">

                <tbody class="searchable">
                <tr style="text-align: center">
                    <td class="searchable"></td>
                    <td class="searchable">X
                        <br/>
                        <label><input id="filterx" type="checkbox">1</label>
                        <label><input id="filterx0" type="checkbox">0</label>
                        <div class="input-group"><span class="input-group-addon"></span>

                    </td>
                    <td class="searchable">Y
                        <br/>
                        <label><input id="filtery" type="checkbox">1</label>
                        <label><input id="filtery0" type="checkbox">0</label>

                </tr>

                <tr>
                    <td>1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td>1</td>
                </tr>

                <tr>
                    <td>2</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td>1</td>
                </tr>

                <tr>
                    <td>3</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>4</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>5</td>
                    <td>0</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>6</td>
                    <td>0</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>7</td>
                    <td>0</td>
                    <td>0</td>
                </tr>

                <tr>
                    <td>8</td>
                    <td>0</td>
                    <td>0</td>
                </tr>

            </table>
        </td>


        <td style="border:15px solid white;">
            <table id="interv" class="table table-striped" style="line-height: 0.8;">

                <tbody class="searchable2">
                <tr style="text-align: center">
                    <td class="searchable2"></td>
                    <td class="searchable2">X
                        <br/>
                        <label><input id="filterx_i" type="checkbox">1</label>
                        <label><input id="filterx0_i" type="checkbox">0</label>
                        <div class="input-group"><span class="input-group-addon"></span>


                    </td>
                    <td class="searchable2">Y
                        <br/>
                        <label><input id="filtery_i" type="checkbox">1</label>
                        <label><input id="filtery0_i" type="checkbox">0</label>
                        <div class="input-group"><span class="input-group-addon"></span>

                </tr>
                <tr>
                    <td>1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>2</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>3</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td>1</td>
                </tr>

                <tr>
                    <td>4</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td>1</td>
                </tr>

                <tr>
                    <td>5</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>6</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td>1</td>
                </tr>

                <tr>
                    <td>7</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                </tr>

                <tr>
                    <td>8</td>
                    <td style="font-weight: bold; color: #d9534f; font-size: 140%">1</td>
                    <td>1</td>
                </tr>
            </table>
        </td>


    </tr>
</table>

<input hidden name="training"/>
{{ formfield_errors 'training' }}
<br>
<div id="cy"></div>


{{ next_button }}


<script src="{{ static 'global/cytoscape.min.js' }}"></script>

<script src=”https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js”></script>

<script>
    var cy = cytoscape({
        container: document.getElementById('cy'),

        boxSelectionEnabled: false,
        autounselectify: true,
        wheelSensitivity: 0.01,

        style: cytoscape.stylesheet()


            .selector('node')
            .css({
                'content': 'data(name)',
                'text-valign': 'center',
                'color': 'black',
                // 'text-outline-width': 2,
                // 'text-outline-color': undefined,
                'background-color': '#666'
            })
            .selector(':selected')
            .css({
                'background-color': 'black',
                'line-color': 'black',
                'target-arrow-color': 'black',
                'source-arrow-color': 'black',
                'text-outline-color': 'black'
            })
            .selector('edge')
            .css({
                'width': 2,
                'line-color': '#ccc',
                'target-arrow-color': 'black',
                'target-arrow-shape': 'triangle',
                'curve-style': 'bezier',
                'line-style': 'dashed'
            })
            .selector('edge[label]')
            .css({
                "label": "data(label)",
                "width": 3
            })
            .selector('layout')
            .css({
                'name': 'grid',
                'rows': 1,
                'cols': 2,
                'padding': 15,
            })
        ,


        elements: {
            nodes: [
                // { style: {'border-color': "red"}, data: {counter:0, id: 'a', name: '-', } },
                {data: {counter: 0, id: 'X', name: 'X',}, style: {'background-color': '#c3cec0'}},
                {data: {counter: 0, id: 'Y', name: 'Y',}, style: {'background-color': '#c3cec0'}},
                {data: {counter: 0, id: 'Z', name: 'Z',}, style: {'background-color': '#c3cec0'}},
                // { data: {counter:0, id: 'Z', name: '-', } }
            ],
            edges: [
                {data: {counter: 0, weight: 0, id: 'XY', source: 'X', target: 'Y', label: ""}},
                {data: {counter: 0, weight: 0, id: 'YX', source: 'Y', target: 'X', label: ""}},
                {data: {counter: 0, weight: 0, id: 'YZ', source: 'Y', target: 'Z', label: ""}},
                {data: {counter: 0, weight: 0, id: 'XZ', source: 'X', target: 'Z', label: ""}},
                {data: {counter: 0, weight: 0, id: 'ZY', source: 'Z', target: 'Y', label: ""}},
                {data: {counter: 0, weight: 0, id: 'ZX', source: 'Z', target: 'X', label: ""}},
                // { data: {counter:0, weight:0, id: 'bc', source: 'Y', target: 'Z', label: "-"} },
            ]
        },


    });

    var layout = cy.layout({
        name: 'circle'
    });

    layout.run();

    const edge_states = ["", ""];
    const edge_colours = ["#ccc", "#000"]
    const edge_type = ['dashed', 'solid']
    const edge_weight = [2, 0]


    cy.on('tap', 'edge', function (evt) {
        var ele = evt.target;
        var edges = cy.edges();
        var form_data = [];
        // console.log(iterator(numbers, ele.data('counter'))[0] );
        ele.data('label', iterator(edge_states, ele.data('counter'))[0]);
        ele.data('counter', iterator(edge_states, ele.data('counter'))[1]);
        ele.data('weight', iterator(edge_weight, ele.data('counter'))[0]);
        ele.style('line-style', edge_type[ele.data('counter')]);
        ele.style('line-color', edge_colours[ele.data('counter')]);
        for (var i = 0; i < edges.length; i++) {
            form_data.push(edges[i]._private.data);
        }
        console.log(form_data);
        liveSend(form_data);
        // sendValue(form_data)
        form_data = [];
    });

    function liveRecv(data) {
        //forminputs.training.value = data;
        formInputs.training.value = data; // for server setting
        console.log(data)
    }


    function iterator(array, i) {
        var index = (i + 1) % array.length;
        var value = array[index];

        return [value, index];
    };
</script>

<script src="{{ static  'data_to_dgp/lang.js'  }}"></script>
<script src="{{ static  'data_to_dgp/utils.js'  }}"></script>

{{ endblock }}
